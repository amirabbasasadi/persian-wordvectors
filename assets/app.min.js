var storage={loaded_vectors:[],words:[]};app={plot_config:{responsive:true},plot_layout:{title:"مصورنمایی بردار واژگان زبان فارسی",font:{size:12,family:"Sahel"}},init:function(){$.ajaxSetup({async:false});app.load_words();app.register_events()},load_words:function(){$.getJSON("assets/data/words_5k.json",function(words){storage.words=words.words})},sample:function(m,max){choices=[];for(var i=0;i<max;i++){choices.push(i)}return choices.sort(function(){return.5-Math.random()}).slice(0,m)},load_vectors:function(filename){data_file="./assets/data/"+filename+".json";$.getJSON(data_file,function(vectors){storage[filename]=vectors;storage.loaded_vectors.push(filename)})},get_plot_data:function(filename,plot_dim){vectors_data=storage[filename];n_vectors=parseInt($("#n_vectors").val());indices=app.sample(n_vectors,vectors_data.x.length);custom_words=$("#custom_words").val().split(" ");custom_words_indices=[];for(var i=0;i<custom_words.length;i++){matchs=fuzzysort.go(custom_words[i],storage.words,{limit:1});ind=-1;if(matchs.length>0){ind=storage.words.indexOf(matchs[0].target)}if(ind>=0){custom_words_indices.push(ind)}}x=[];y=[];z=[];words=[];for(var i=0;i<indices.length;i++){x.push(vectors_data.x[indices[i]]);y.push(vectors_data.y[indices[i]]);if(plot_dim=="3d"){z.push(vectors_data.z[indices[i]])}words.push(storage.words[indices[i]])}plot_mode=$("input[name=plot_mode]:checked").val();var trace={x:x,y:y,z:z,hovertext:words,hovertemplate:"%{hovertext}",mode:plot_mode,text:words,textposition:"bottom center",type:"scatter",name:""};if(plot_dim=="3d"){trace["type"]="scatter3d";trace["marker"]={size:2}}x_custom=[];y_custom=[];z_custom=[];words_custom=[];for(var i=0;i<custom_words_indices.length;i++){x_custom.push(vectors_data.x[custom_words_indices[i]]);y_custom.push(vectors_data.y[custom_words_indices[i]]);if(plot_dim=="3d"){z_custom.push(vectors_data.z[custom_words_indices[i]])}words_custom.push(storage.words[custom_words_indices[i]])}var trace_custom={x:x_custom,y:y_custom,z:z_custom,hovertext:words_custom,hovertemplate:"%{hovertext}",backgroundcolor:"blue",mode:plot_mode,type:"scatter",name:"کلمات دلخواه",marker:{color:"#2d2d2d"}};if(plot_dim=="3d"){trace_custom["type"]="scatter3d";trace_custom["marker"]["size"]=3}return[trace,trace_custom]},generate_plot:function(filename,plot_dim){plot_data=app.get_plot_data(filename,plot_dim);Plotly.newPlot("tester",plot_data,app.plot_layout,app.plot_config)},plot:function(){plot_dim=$("#plot_dim").find(":selected").attr("value");vectors_type=$("#vectors_type").find(":selected").attr("value");reduction_method=$("#reduction_method").find(":selected").attr("value");filename=vectors_type+"_vectors_5k_"+plot_dim+"_"+reduction_method;if(storage.loaded_vectors.indexOf(filename)<0){app.load_vectors(filename)}app.generate_plot(filename,plot_dim)},register_events:function(){$("#plot").click(function(){app.plot()})}};$(document).ready(function(){app.init();app.plot()});
